\documentclass[a4paper,12pt]{report}

\input{header.tex}


\title{Отчёт по курсовому проекту }
\author{(Пучнина Анастасия Ивановна, Козлова Юлия Алексеевна)}

\begin{document}

\maketitle

\tableofcontents

\addcontentsline{toc}{chapter}{Введение}
\chapter*{Введение}

\section{Серверная часть SMTP агента}

\subsection{Задание. Вариант 10}

Используется вызов pselect и единственный рабочий поток. Журналирование в отдельном процессе. Нужно проверять обратную зону днс.

\subsection{Цель и задачи}

Цель:
    Разработать \textbf{SMTP-сервер} с использованием одного потока и метода pselect().

Задачи:
\begin{itemize}
    \item проанализировать архитектурное решение;
    \item разработать подход для обработки входящих соединений;
    \item разработать подход хранения входящих писем в maildir;
    \item проанализировать \textbf{SMTP}-протокол и разработать конечный автомат обработки SMTP-сообщений;
    \item реализовать программу для получения и сохранения писем по протоколу \textbf{SMTP}.
\end{itemize}

\section{Клиентская часть SMTP агента}

\subsection{Задание. Вариант 31}

Используется вызов select и единственный рабочий поток (или процесс). Журналирование в отдельном процессе. Пытаться отправлять все сообщения для одного MX за одну сессию.

.... % Юле сюда надо добавить свою часть

\chapter{Аналитический раздел}

\section*{Предметная область}

\subsection*{ER-диаграмма предметной области}

В результате проведенного исследования были выявлены следующие сущности предметной области:

\begin{enumerate}
    \item Отправитель.
    \item Получатель.
    \item Пользователь.
    \item Электронное письмо.
    \item Файл письма.
    \item Каталог Maildir.
\end{enumerate}

Зависимость между сущностями предметной области может быть описана ER-диаграммой (~\ref{fig:er_diagram} ). Диаграмма выполнена в соответствии с нотацией UML.
\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{../images/er_diagram.png}
    \caption{ER-диаграмма предметной области}
    \label{fig:er_diagram}
\end{figure}


\section*{Достоинства и недостатки реализуемой архитектуры}

\subsection*{Серверная часть SMTP агента}

Согласно условию задачи, в работе сервера предлагается использовать один поток выполнения и один отдельный поток
журналирования.

Достоинства данного варианта реализации:
\begin{itemize}
    \item простота реализации, отсутствует необходимость реализации разделяемой памяти и взаимодействия между процессами или потоками;
    \item отсутствие времени на переключение контекстов;
    \item благодаря неблокирующему вводу/выводу, сервер может обслуживать множество клиентов с достаточно высокой производительностью, при условии, что обработка занимает мало времени;
    \item логирование в отдельном процессе позволяет не блокироваться на операциях ввода/вывода при записи в файл или в терминал;
\end{itemize}

Недостатки данной архитектуры:
\begin{itemize}
    \item низкая производительность при длительной обработке клиентских команд;
    \item низкая отказоустойчивость (использование одного потока является менее надежным при возникновении фатальных ошибок в приложении, чем при наличии нескольих взаимозаменяемых потоков,);
    \item сложность масштабирования и использования всех аппаратных ресурсов системы.
\end{itemize}

Недостатки программной реализации с одним потоком выполнения и мультиплексированием можно уменьшить с  помощью
создания нескольких (пула) потоков с неблокирующим вводом/выводом и распределения нагрузки между ними.

\subsection*{Клиентская часть SMTP агента}

.... % Юле сюда надо добавить свою часть

\chapter{Конструкторский раздел}

\section{Конечный автомат состояний сервера}

На рис.~\ref{fig:server_fsm} представлен сгенерированный с использованием \textit{fsm2dot} скрипта из \textit{autogen}
файла конфигурации конечного автомата \textit{serverfsm.def} и \textit{dot}.

Данный рисунок не отображает переходы между состояниями при использовании именнованных обработчиков,
поэтому, для корректного отображения конечного автомата, был создан специальный файл конфигурации
\textit{serverfsm_report.def} без использования в \textit{autogen} параметров \textit{ttype} в переходах автомата.
Построенный таким образом граф состояний представлен на рис.~\ref{fig:server_fsm_report}.

\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{../images/serverfsm.png}
    \caption{Построенный граф конечного автомата SMTP сервера с использованием именнованных обработчиков}
    \label{fig:serverfsm_def}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{../images/serverfsm_report.png}
    \caption{Граф состояний конечного автомата SMTP сервера}
    \label{fig:serverfsm_report_def}
\end{figure}


\section{Синтаксис команд протокола}
Ниже приведен формат команд сообщений протокола в виде регулярных выражений:

Общие регулярные выражения:
\begin{description}
\item[Перевод строки]
\input{regexp/re_crlf.tex}
\item[Пробелы]
\input{regexp/re_space.tex}
\item[Доменное имя]
\input{regexp/re_domain.tex}
\item[Электронный адрес или пустые скобки]
\input{regexp/re_email_or_empty.tex}
\item[Электронный адрес]
\input{regexp/re_email.tex}
\end{description}

Регулярные выражения SMTP команд:
\begin{description}
    \item[NOOP]
    \input{regexp/re_cmnd_noop.tex}
    \item[HELO]
    \input{regexp/re_cmnd_helo.tex}
    \item[EHLO]
    \input{regexp/re_cmnd_ehlo.tex}
    \item[MAIL]
    \input{regexp/re_cmnd_mail.tex}
    \item[RCPT]
    \input{regexp/re_cmnd_rcpt.tex}
    \item[VRFY]
    \input{regexp/re_cmnd_vrfy.tex}
    \item[DATA]
    \input{regexp/re_cmnd_data.tex}
    \item[RSET]
    \input{regexp/re_cmnd_rset.tex}
    \item[QUIT]
    \input{regexp/re_cmnd_quit.tex}
\end{description}

Регулярные выражения содержимого письма:
\begin{description}
    \item[Данные письма]
    \input{regexp/re_mail_data.tex}
    \item[Окончание данных письма]
    \input{regexp/re_mail_end.tex}
\end{description}

\section{Синтаксис команд протокола}
На рис.~\ref{fig:uml_server_ph} и на рис.~\ref{fig:uml_server_log} представлены физическая и логическая
диаграммы представления данных в системе соответственно.

\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{../images/uml_server_ph.png}
    \caption{Физическая диаграмма представления данных в серверной части системы}
    \label{fig:uml_server_ph}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{../images/uml_server_log.png}
    \caption{Логическая диаграмма представления данных в серверной части системы}
    \label{fig:uml_server_log}
\end{figure}


Конфигурация \textit{serveropts.def}, используемая для автоматической генерации исходного кода обработки
входных флагов приложенияс помощью \textit{autogen}.:

\lstset{language=C}
\lstinputlisting{../../source/server/autogen/serveropts.def}

\chapter{Технологический раздел}

\section{Сборка программы}

Сборка SMTP агента состоит из трех \textit{Makefile} системы сборки \textit{make}:

\begin{itemize}
    \item сборка клиента,
    \item сборка сервера,
    \item сборка отчета.
\end{itemize}

\subsection{Сборка серверной части SMTP агента}

Сборка SMTP сервера состоит из следующих целей:

\begin{enumerate}
    \item сборка сервера;
    \item сборка тестового клиента;
    \item генерация исходных кодов конечного автомата и опций с помощью \textit{autogen};
    \item сборка сервера и тестового клиента;
    \item запуск системного тестирования.
\end{enumerate}

Сборка программы осуществляется с помощью следующей команды:
\begin{verbatim}
    make autogen_all && make all
\end{verbatim}


\addcontentsline{toc}{chapter}{Выводы}

\chapter*{Выводы}

\section{Серверная часть SMTP агента}

В результате выполнения курсового проекта была достугнута поставленная цель, а именно разработан
\textbf{SMTP-сервер} с использованием одного потока и метода pselect(), осуществляющее прием и сохранение писем
для дальнейшей поставки их пользователям.

Во время выполнения работы были выполнены следующие задачи:
\begin{itemize}
    \item проанализировано архитектурное решение, данное по условиям задачи, определены его преимущества и недостатки;
    \item разработан и реализован подход для обработки входящих соединений на основе метода pselect();
    \item разработан и реализовано хранение входящих писем в каталоге maildir;
    \item проанализирован протокол \textbf{SMTP} и реализован конечный автомат обработки входящих SMTP-сообщений;
\end{itemize}

А также получены и закреплены следующие навыки:
\begin{itemize}
    \item проектирование и реализация сетевого протокола SMTP;
    \item реализация серверного приложения с несколькими процессами на языке программирования Си;
    \item создание сценариев сборки программного обеспечения;
    \item использование latex и сценариев сборки для автогенерации расчетно-пояснительной записки.
\end{itemize}

В ходе работы не были реализованы следующие пункты, планируемые к разработке в дальнейшем:
\begin{itemize}
    \item проверка обратной зоны DNS;
    \item генерация документации и графов функци с помощью утилит;
    \item использование внешних конфигурационных файлов;
    \item модульное тестирование;
\end{itemize}


\end{document}
